"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const parse_and_validate_raw_data_1 = __importDefault(require("./parse-and-validate-raw-data"));
const read_file_1 = __importDefault(require("./read-file"));
function writeFile(path, newRawData, structure) {
    const data = (0, read_file_1.default)(path, structure);
    const parsedAndValidatedData = newRawData.map(raw => {
        return (0, parse_and_validate_raw_data_1.default)(raw, structure.props);
    });
    parsedAndValidatedData.forEach((currData) => {
        Object.entries(currData).forEach(([ref, val]) => {
            if (ref == 'id')
                return;
            const previousLocalData = data.find(x => x.id == currData.id);
            if (!previousLocalData)
                return data.push(currData);
            const localDataIndex = data.indexOf(previousLocalData);
            data[localDataIndex][ref] = val;
        });
    });
    (0, fs_1.writeFileSync)(path, JSON.stringify(data, null, 2), 'utf-8');
}
exports.default = writeFile;
